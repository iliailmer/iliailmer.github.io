
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

  <link
    href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="https://iliailmer.github.io/theme/stylesheet/style.min.css">

  <link id="dark-theme-style" rel="stylesheet" type="text/css"   media="(prefers-color-scheme: dark)"      href="https://iliailmer.github.io/theme/stylesheet/dark-theme.min.css">

  <link id="pygments-dark-theme" rel="stylesheet" type="text/css"      media="(prefers-color-scheme: dark)"      href="https://iliailmer.github.io/theme/pygments/monokai.min.css">
  <link id="pygments-light-theme" rel="stylesheet" type="text/css"     media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"      href="https://iliailmer.github.io/theme/pygments/emacs.min.css">

  <link rel="stylesheet" href="https://iliailmer.github.io/theme/tipuesearch/tipuesearch.min.css" />

  <link rel="stylesheet" type="text/css" href="https://iliailmer.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://iliailmer.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://iliailmer.github.io/theme/font-awesome/css/solid.css">


  <link href="https://iliailmer.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
    title="Ilia Ilmer Atom">


  <link rel="shortcut icon" href="https://iliailmer.github.io/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="https://iliailmer.github.io/images/favicon.ico" type="image/x-icon">

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-131502498-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333">


<meta name="author" content="Ilia Ilmer" />
<meta name="description" content="In this short post, I wanted to point out one interesting application of regular expressions I had to work on for my PhD research project. The code was meant as a technical tool to help tranlate some ordingary differential equation models from numerical (Matlab) to symbolic (Maple) code. The original …" />
<meta name="keywords" content="python, regular expressions, matlab, maple">


  <meta property="og:site_name" content="Ilia Ilmer"/>
  <meta property="og:title" content="How I had to translate Matlab code into Maple"/>
  <meta property="og:description" content="In this short post, I wanted to point out one interesting application of regular expressions I had to work on for my PhD research project. The code was meant as a technical tool to help tranlate some ordingary differential equation models from numerical (Matlab) to symbolic (Maple) code. The original …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://iliailmer.github.io/2020/08/matlab-2-maple.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2020-08-18 00:00:00-04:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://iliailmer.github.io/author/ilia-ilmer.html">
  <meta property="article:section" content="Posts"/>
  <meta property="article:tag" content="python"/>
  <meta property="article:tag" content="regular expressions"/>
  <meta property="article:tag" content="matlab"/>
  <meta property="article:tag" content="maple"/>
  <meta property="og:image" content="https://iliailmer.github.io/images/compressed.jpeg">

  <title>Ilia Ilmer &ndash; How I had to translate Matlab code into Maple</title>

</head>

<body >
  <aside>
    <div>
      <a href="https://iliailmer.github.io/">
        <img src="https://iliailmer.github.io/images/compressed.jpeg" alt="Ilia Ilmer" title="Ilia Ilmer">
      </a>

      <h1>
        <a href="https://iliailmer.github.io/">Ilia Ilmer</a>
      </h1>

<p>Algorithms and Coffee</p>
      <form class="navbar-search" action="https://iliailmer.github.io/search.html" role="search">
        <input type="text" name="q" id="tipue_search_input" placeholder="Search...">
      </form>

      <nav>
        <ul class="list">


          <li>
            <a target="_self"
              href="https://iliailmer.github.io/pages/about.html#about">
              About
            </a>
          </li>
          <li>
            <a target="_self"
              href="https://iliailmer.github.io/pages/publications.html#publications">
              Publications
            </a>
          </li>
          <li>
            <a target="_self"
              href="https://iliailmer.github.io/pages/software.html#software">
              Software
            </a>
          </li>
          <li>
            <a target="_self"
              href="https://iliailmer.github.io/pages/talks.html#talks">
              Talks
            </a>
          </li>

        </ul>
      </nav>

      <ul class="social">
        <li>
          <a  class="sc-github" href="https://github.com/iliailmer" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        </li>
        <li>
          <a  class="sc-gitlab" href="https://gitlab.com/iliailmer" target="_blank">
            <i class="fab fa-gitlab"></i>
          </a>
        </li>
        <li>
          <a  class="sc-linkedin" href="https://linkedin.com/in/iilmer" target="_blank">
            <i class="fab fa-linkedin"></i>
          </a>
        </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="https://iliailmer.github.io/">Home</a>

      <a href="/files/resume.pdf">CV</a>

      <a href="https://iliailmer.github.io/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
    
    <h1 id="matlab-2-maple">How I had to translate Matlab code into Maple</h1>
    <p>
      Posted on Tue 18 August 2020 in <a href="https://iliailmer.github.io/category/posts.html">Posts</a>

    </p>
  </header>


  <div>
    <p>In this short post, I wanted to point out one interesting application of regular expressions I had to work on for my PhD research project. The code was meant as a technical tool to help tranlate some ordingary differential equation models from numerical (Matlab) to symbolic (Maple) code.</p>
<h2 id="the-original-code">The original code</h2>
<p>The original *.m files were pulled from <a href="https://www.ebi.ac.uk/biomodels/">this</a> webpage using <code>wget</code> and their own API. Ordingary differential equation (ODE) models in those files contain a special function called <code>xdot</code>. It returns an array of <code>n</code> elements, which form right-hand side of an ODE.</p>
<p>The function is usually defined in the form</p>
<pre><code class="language-m">function xdot=f(x,t)
    % define parameters as
    C = 1.0;
    % ...
    xdot = zeros(..., ...);
    % define each xdot(i) separately
end
</code></pre>
<p>What I wanted to see in the maple code was the following:</p>
<pre><code class="language-py">#  define parameters as symbolic constants
C := C:

#  define system of odes as array

sigma := [
    diff(x1(t), t) = &lt;...&gt;,
    &lt;...&gt;
    diff(xn(t), t) = &lt;...&gt;
]:
</code></pre>
<p>The best way to solve it I saw was to use regular expressions.</p>
<h2 id="step-by-step">Step by step</h2>
<p>Firstly, I had to get rid of Matlab comment and turn them into Maple compatible ones, hence the line</p>
<pre><code class="language-py">out_program = re.findall(
                r&quot;function xdot=f\(x,t\)(.*?)end&quot;, content, re.DOTALL
            )[0].replace(&quot;%&quot;, &quot;#&quot;)
</code></pre>
<p>After that, we want to look at <code>if</code> statements. In Maple, conditional structure like <code>if</code> statements are written as</p>
<pre><code class="language-pascal">if &lt;condition&gt; then &lt;code&gt; end:
</code></pre>
<p>To do that, we utilize groups: <code>(..)</code>. The regex is</p>
<pre><code class="language-py">out_program = re.sub(
                r&quot;if(\(\w*\))(.*;)end&quot;,
                r&quot;if \1 then \2\nend if:&quot;,
                out_program,
                flags=re.DOTALL,
            )
</code></pre>
<p>The <code>if(\(\w*\))(.*;)end</code> regex gets the condition <code>\(\w*\)</code> and the code (.*;) between <code>if</code> / <code>end</code> to place those between <code>if</code>, <code>then</code>, <code>end</code> in positions marked by <code>\1</code> and <code>\2</code>.</p>
<p>Remeber, that we do not want to have <code>xdot(i)=...</code> assigned manually anymore in Maple, we want to see Maple syntax: <code>diff(x(t),t) = ...</code>, so we do the following regex:</p>
<pre><code class="language-py">out_program = re.sub(
                r&quot;xdot\((\d+)\) \=( .*);&quot;, r&quot;\ndiff(x\1(t), t) = \2,&quot;, out_program
            )
</code></pre>
<p>Again, notice the groups that capture stuff we want to preserve, namely the index of <code>xdot</code> and the right-hand sides.</p>
<p>Next few lines do some cosmetic work, namely, rename any <code>x(i)</code> appearance into <code>xi(t)</code>, then make all variable assingments symbolic constants (i.e. if we have <code>c=0</code> we want to have <code>c:=c</code>). Finally, if we have Matlab assignments that do not use constants (i.e. <code>c=0; x = c+x;</code>) we want to keep them (i.e. <code>c:=c: x:=c+x:</code>).</p>
<pre><code class="language-py">out_program = re.sub(r&quot;x\((\d+)\)&quot;, r&quot;x\1(t)&quot;, out_program) # x(i) -&gt; xi(t)
out_program = re.sub(r&quot;(\w+)\=\d*\..*&quot;, r&quot;\1:=\1:&quot;, out_program) # c=NUMBER -&gt; c:=c:
out_program = re.sub(r&quot;(\w+)\=(.*);&quot;, r&quot;\1:=\2:&quot;, out_program) # Left-side = ANYTHING NOT METNIONED ABOVE -&gt; same but with := sign
</code></pre>
<p>Finally, putting it all together we can run:</p>
<pre><code class="language-py">import re
from glob import glob
from tqdm.auto import tqdm

files = glob(&quot;files/*/*/*.m&quot;)

for i in tqdm(range(len(files))):
    with open(files[i], &quot;r&quot;) as f:
        try:
            content = f.read()
        except:
            print(files[i], &quot;could not read&quot;)
        try:
            out_program = re.findall(
                r&quot;function xdot=f\(x,t\)(.*?)end&quot;, content, re.DOTALL
            )[0].replace(&quot;%&quot;, &quot;#&quot;)
            out_program = re.sub(
                r&quot;if(\(\w*\))(.*;)end&quot;,
                r&quot;if \1 then \2\nend if:&quot;,
                out_program,
                flags=re.DOTALL,
            )
            out_program = re.sub(
                r&quot;xdot\((\d+)\) \=( .*);&quot;, r&quot;\ndiff(x\1(t), t) = \2,&quot;, out_program
            )
            out_program = re.sub(r&quot;(xdot=zeros.*)&quot;, r&quot;# \1&quot;, out_program) # comment out declaration of xdot

            out_program = re.sub(r&quot;x\((\d+)\)&quot;, r&quot;x\1(t)&quot;, out_program)
            out_program = re.sub(r&quot;(\w+)\=\d*\..*&quot;, r&quot;\1:=\1:&quot;, out_program)
            out_program = re.sub(r&quot;(\w+)\=(.*);&quot;, r&quot;\1:=\2:&quot;, out_program)
            # cosmetic work to make maple run and not complain about trailing comma
            out_program = re.sub(
                r&quot;(diff.*)&quot;, r&quot;sigma := [\n\1]:&quot;, out_program, flags=re.DOTALL
            ).replace(&quot;,\n]&quot;, &quot;\n]&quot;)

            outname = files[i].split(&quot;.&quot;)[0] + &quot;.mpl&quot;

            with open(outname, &quot;w&quot;) as output:
                output.write(out_program)
            import os

            os.system(&quot;mkdir -p new_examples&quot;)
            os.system(f&quot;cp {outname} new_examples&quot;)
        except:
            print(files[i], &quot;Index not Found.&quot;)

</code></pre>
<p>Some stuff really specific to our project was omitted for brevity, but one can definitely add any other Maple/Matlab interaction here.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://iliailmer.github.io/tag/python.html">python</a>
      <a href="https://iliailmer.github.io/tag/regular-expressions.html">regular expressions</a>
      <a href="https://iliailmer.github.io/tag/matlab.html">matlab</a>
      <a href="https://iliailmer.github.io/tag/maple.html">maple</a>
    </p>
  </div>





</article>

    <footer>
<p>
  &copy; 2021  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://iliailmer.github.io/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Ilia Ilmer ",
  "url" : "https://iliailmer.github.io",
  "image": "https://iliailmer.github.io/images/compressed.jpeg",
  "description": ""
}
</script>

</body>

</html>